<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GPT Realtime Sprachinteraktion</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background-color: #f5f5f5; }
    #chat { max-width: 600px; margin: auto; text-align: center; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    #response { margin-top: 20px; padding: 10px; background-color: #fff; border-radius: 8px; min-height: 50px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div id="chat">
    <h2>GPT Realtime Sprachinteraktion</h2>
    <button id="startRecording">Aufnahme starten</button>
    <div id="response"></div>
  </div>

  <script>
    const apiKey = "Eis5WxkoPVJ4lteBhreUvGaaWMKtreMkDHeP1oY8R39VRYHbkeTIJQQJ99BLACfhMk5XJ3w3AAAAACOGSCaz";
    const endpoint = "https://daytrading-resource.cognitiveservices.azure.com";
    const deploymentName = "gpt-realtime";

    const responseDiv = document.getElementById("response");
    const startRecordingButton = document.getElementById("startRecording");

    let recognition = null;
    let synth = window.speechSynthesis;

    startRecordingButton.addEventListener("click", () => {
      if (!recognition) {
        // Spracheingabe aktivieren
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'de-DE';
        recognition.interimResults = false;
        recognition.onresult = async (event) => {
          const spokenText = event.results[0][0].transcript;
          responseDiv.innerHTML = `Du hast gesagt: "${spokenText}"\nGPT antwortet...`;

          // Anfrage an GPT senden
          const response = await fetch(`${endpoint}/openai/deployments/${deploymentName}/chat/completions?api-version=2023-03-15-preview`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "api-key": apiKey
            },
            body: JSON.stringify({
              messages: [{ role: "user", content: spokenText }],
              max_tokens: 300
            })
          });

          const data = await response.json();
          const gptMessage = data.choices?.[0]?.message?.content || "Keine Antwort erhalten";
          responseDiv.innerHTML = `Du hast gesagt: "${spokenText}"\nGPT sagt: "${gptMessage}"`;

          // Sprachsynthese: GPT-Antwort vorlesen
          const utterance = new SpeechSynthesisUtterance(gptMessage);
          synth.speak(utterance);
        };

        recognition.start();
        startRecordingButton.textContent = "Aufnahme stoppen";
        recognition.onend = () => {
          recognition = null;
          startRecordingButton.textContent = "Aufnahme starten";
        };

      } else {
        recognition.stop();
      }
    });
  </script>
</body>
</html>
